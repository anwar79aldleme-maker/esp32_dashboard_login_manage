<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Patients</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#0a0f1a;
  color:#fff;
  font-family:Segoe UI;
}
h2 { text-align:center; color:#00ffff; }
table {
  width:95%;
  margin:auto;
  border-collapse:collapse;
}
th,td {
  border:1px solid #00ffff44;
  padding:8px;
  text-align:center;
}
th { background:#001f2f; }
input,button {
  padding:8px;
  border-radius:6px;
  border:none;
}
button {
  background:#00ffff;
  cursor:pointer;
  font-weight:bold;
}
.form {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:10px;
  width:95%;
  margin:15px auto;
}
</style>
</head>

<body>

<script>
if(localStorage.getItem('auth')!=='1') location.href='/login.html';
</script>

<h2>ðŸ§¾ Patient Management</h2>

<div class="form">
  <input id="device_id" placeholder="Device ID">
  <input id="pname" placeholder="Patient Name">
  <input id="pmobile" placeholder="Mobile">
  <input id="spo2" placeholder="SpOâ‚‚">
  <input id="heartrate" placeholder="Heart Rate">
  <button onclick="add()">Add</button>
</div>

<table>
<thead>
<tr>
<th>ID</th><th>Device</th><th>Name</th><th>Mobile</th>
<th>SpOâ‚‚</th><th>HR</th><th>Time</th><th>Action</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
async function load(){
  const res=await fetch('/api/get');
  const data=await res.json();
  const tbody=document.getElementById('rows');
  tbody.innerHTML='';
  data.forEach(r=>{
    tbody.innerHTML+=`
<tr>
<td>${r.id}</td>
<td>${r.device_id}</td>
<td>${r.pname}</td>
<td>${r.pmobile}</td>
<td>${r.spo2}</td>
<td>${r.heartrate}</td>
<td>${new Date(r.time).toLocaleString()}</td>
<td>
<button onclick="del(${r.id})">ðŸ—‘</button>
</td>
</tr>`;
  });
}

async function add(){
  await fetch('/api/add',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      device_id:device_id.value,
      pname:pname.value,
      pmobile:pmobile.value,
      spo2:+spo2.value,
      heartrate:+heartrate.value
    })
  });
  load();
}

async function del(id){
  await fetch('/api/delete',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({id})
  });
  load();
}

load();
</script>

</body>
</html>

