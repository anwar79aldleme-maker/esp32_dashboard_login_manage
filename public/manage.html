<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Patients</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#0a0f1a;
  color:#fff;
  font-family:Segoe UI;
}
h2 { text-align:center; color:#00ffff; margin-top:20px; }
table {
  width:95%;
  margin:auto;
  border-collapse:collapse;
}
th,td {
  border:1px solid #00ffff44;
  padding:8px;
  text-align:center;
}
th { background:#001f2f; }
input,button {
  padding:8px;
  border-radius:6px;
  border:none;
}
button {
  background:#00ffff;
  cursor:pointer;
  font-weight:bold;
}
button:hover { background:#00bcd4; color:#fff; }
.form {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:10px;
  width:95%;
  margin:15px auto;
}
</style>
</head>

<body>

<script>
if(localStorage.getItem('auth')!=='1') location.href='/login.html';
</script>

<h2>ðŸ§¾ Patient Management</h2>

<div class="form">
  <input id="device_id" placeholder="Device ID">
  <input id="pname" placeholder="Patient Name">
  <input id="pmobile" placeholder="Mobile">
  <input id="email" placeholder="Email">
  <input id="age" placeholder="Age">
  <button onclick="addPatient()">Add</button>
  <button onclick="editPatient()"> Edit </button>
</div>

<table>
<thead>
<tr>
<th>ID</th><th>Device ID</th>
<th>Patient Name</th><th>Mobile</th><th>Email</th><th>Age</th><th>Action</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
async function loadPatients(){
  try {
    const res = await fetch('/api/infoGet');
    const data = await res.json();
    const tbody = document.getElementById('rows');
    tbody.innerHTML = '';

    data.forEach(r => {
      tbody.innerHTML += `
<tr>
<td>${r.id}</td>
<td>${r.device_id}</td>
<td>${r.p_name}</td>
<td>${r.ph_no}</td>
<td>${r.email}</td>
<td>${r.age}</td>
<td>
<button onclick="deletePatient(${r.id})">ðŸ—‘ Delete</button>
</td>
</tr>`;
    });
  } catch(err){
    console.error('Load patients error:', err);
  }
}
async function editPatient(){
  const body = {
    device_id: document.getElementById('device_id').value,
    pname: document.getElementById('pname').value,
    pmobile: document.getElementById('pmobile').value,
    email:document.getElementById('email').value,
age: Number(document.getElementById('age').value)
  };

  if(!body.device_id || !body.pname) {
    alert('Device ID and Patient Name are required!');
    return;
  }

  try {
    await fetch('/api/update', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    clearForm();
    loadPatients();
  } catch(err){
    console.error('Add patient error:', err);
  }
}

async function addPatient(){
  const body = {
    device_id: document.getElementById('device_id').value,
    pname: document.getElementById('pname').value,
    pmobile: document.getElementById('pmobile').value,
    email:document.getElementById('email').value,
age: Number(document.getElementById('age').value)
  };

  if(!body.device_id || !body.pname) {
    alert('Device ID and Patient Name are required!');
    return;
  }

  try {
    await fetch('/api/add', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    clearForm();
    loadPatients();
  } catch(err){
    console.error('Add patient error:', err);
  }
}

async function deletePatient(id){
  if(!confirm('Are you sure you want to delete this patient?')) return;
  try {
    await fetch('/api/infoDelete', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({id})
    });
    loadPatients();
  } catch(err){
    console.error('Delete patient error:', err);
  }
}

function clearForm(){
  document.getElementById('device_id').value = '';
  document.getElementById('pname').value = '';
  document.getElementById('pmobile').value = '';
  document.getElementById('email').value = '';
  document.getElementById('age').value = '';
}

loadPatients();
</script>

</body>
</html>
